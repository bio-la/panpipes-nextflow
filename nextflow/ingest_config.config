process.executor = 'local'
docker.enabled = true

params {

    project              = "Teaseq"
    sample_prefix        = "teaseq"
    use_existing_h5mu    = false
    metadatacols         = null
    concat_join_type     = "inner"
    input = "/sample_file_qc.txt"
    submission_file = "/sample_file_qc.txt"
    
    // Modalities in the project
    modalities = [
        rna : true,
        prot: true,
        bcr : false,
        tcr : false,
        atac: true
    ]

    // Integrating barcode level data
    barcode_mtd = [
        include      : false,
        path         : null,
        metadatacols : null
    ]

    //------------------------------------------
    // Loading Protein data - additional options
    protein_metadata_table    = null
    index_col_choice          = null
    load_prot_from_raw        = false
    subset_prot_barcodes_to_rna = false

    // -----------------------------------
    // Processing of 10X cellranger metrics files
    plot_10X_metrics = true

    // Doublet detection on RNA modality
    scr = [
        run                     : true,
        expected_doublet_rate   : 0.06,
        sim_doublet_ratio       : 2,
        n_neighbours            : 20,
        min_counts              : 2,
        min_cells               : 3,
        min_gene_variability_pctl: 85,
        n_prin_comps            : 30,
        use_thr                 : true,
        call_doublets_thr       : 0.25
    ]

    // RNA modality Quality Control
    custom_genes_file    = "/qc_genelist_1.0.csv"
    calc_proportions     = "hb,mt,rp"
    score_genes          = null
    ccgenes              = "default"

    // Plotting RNA QC metrics
    plotqc_grouping_var  = "orig.ident"
    plotqc_rna_metrics   = "doublet_scores,pct_counts_mt,pct_counts_rp,pct_counts_hb,pct_counts_ig"

     // Plotting Protein QC metrics
    plotqc_prot_metrics  = "total_counts,log1p_total_counts,n_prot_by_counts,pct_counts_isotype"
    plot_metrics_per_prot= "total_counts,log1p_total_counts,n_cells_by_counts,mean_counts"
    identify_isotype_outliers = true
    isotype_upper_quantile    = 90
    isotype_n_pass            = 2

    // Plot ATAC QC metrics
    is_paired            = true
    partner_rna          = null
    features_tss         = null
    plotqc_atac_metrics  = "n_genes_by_counts,total_counts,pct_fragments_in_peaks,atac_peak_region_fragments,atac_mitochondrial_reads,atac_TSS_fragments"

    // Plot Repertoire QC metrics
    ir_dist = [
        metric  : null,
        sequence: null
    ]

    clonotype_definition = [
        receptor_arms: null,
        dual_ir      : null,
        within_group : null
    ]

    plotqc_rep_metrics = [
        "is_cell",
        "extra_chains",
        "clonal_expansion",
        "rep:receptor_type",
        "rep:receptor_subtype",
        "rep:chain_pairing",
        "rep:multi_chain"
    ]

    // Profiling Protein Ambient background
    assess_background      = false
    downsample_background  = true

    // Investigate per-channel antibody staining
    channel_col            = "sample_id"
    save_norm_prot_mtx     = false

    // Protein normalization
    normalisation_methods  = "clr"

    // Centered log ratio (CLR) normalization options
    clr_margin             = 1

    // Denoised and Scaled by Background (DSB) normalization options
    quantile_clipping      = true

    outdir = "./results"
    resources = "/Users/mylenemarianagonzalesandre/Development/HiWi/Panpipes/data/ingest_copy/resources"

}

